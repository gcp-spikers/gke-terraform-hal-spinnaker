timeout: 900s

steps:
- name: 'gcr.io/hal-spinnaker/tf-hal'
  entrypoint: 'bash'
  env:
  - 'HOME=/root'
  volumes:
  - name: 'dot_hal_dir'
    path: '/home/hal/.hal'
  args:
  - '-c'
  - |
    set -ex
    terraform init -backend-config='bucket=terraform-190393331717' -input=false
    terraform plan -out terraform.plan -var 'project=${PROJECT_ID}'
    terraform apply terraform.plan
- name: 'gcr.io/cloud-builders/gsutil'
  args: ['-m', 'cp', '-r', '/home/hal/.hal', 'gs://terraform-190393331717/dot_hal_dir' ]
  volumes:
  - name: 'dot_hal_dir'
    path: '/home/hal/.hal'

